## 坏味道——发散式变化(Divergent Change)

> `发散式变化(Divergent Change)` 类似于 `霰弹式修改(Shotgun Surgery)` ，但实际上完全不同。`发散式变化(Divergent Change)` 是指一个类受多种变化的影响。`霰弹式修改(Shotgun Surgery)` 是指多种变化引发多个类相应的修改。

### 特征

你发现你想要修改一个函数，却必须要同时修改许多不相关的函数。例如，当你想要添加一个新的产品类型时，你需要同步修改对产品进行查找、显示、排序的函数。

![img](https://raw.githubusercontent.com/atlantis1024/JavaParty/master/images/%E7%BC%96%E7%A8%8B/%E9%AB%98%E6%95%88%E7%BC%96%E7%A8%8B/%E9%87%8D%E6%9E%84/divergent-change/divergent-change-1.png)

### 问题原因

通常，这种发散式修改是由于编程结构不合理或者“复制-粘贴式编程”。

### 解决办法

- 运用 `提炼类(Extract Class)` 拆分类的行为。
- 如果不同的类有相同的行为，你可以考虑通过继承来合并类（`提炼超类(Extract Superclass)` 和 `提炼子类(Extract Subclass)`）。

### 收益

- 提高代码组织结构
- 减少重复代码



## 重构方法说明

### 提炼类(Extract Class)

**问题**

某个类做了不止一件事。
![img](https://raw.githubusercontent.com/atlantis1024/JavaParty/master/images/%E7%BC%96%E7%A8%8B/%E9%AB%98%E6%95%88%E7%BC%96%E7%A8%8B/%E9%87%8D%E6%9E%84/large-class/Extract Class - Before.png)


**解决**

建立一个新类，将相关的字段和函数从旧类搬移到新类。
![img](https://raw.githubusercontent.com/atlantis1024/JavaParty/master/images/%E7%BC%96%E7%A8%8B/%E9%AB%98%E6%95%88%E7%BC%96%E7%A8%8B/%E9%87%8D%E6%9E%84/large-class/Extract Class - After.png)


### 提炼超类(Extract Superclass)

**问题**

两个类有相似特性。

![img](https://raw.githubusercontent.com/atlantis1024/JavaParty/master/images/%E7%BC%96%E7%A8%8B/%E9%AB%98%E6%95%88%E7%BC%96%E7%A8%8B/%E9%87%8D%E6%9E%84/refused-bequest/Extract%20Superclass%20-%20Before.png)

**解决**

为这两个类建立一个超类，将相同特性移至超类。

![img](https://raw.githubusercontent.com/atlantis1024/JavaParty/master/images/%E7%BC%96%E7%A8%8B/%E9%AB%98%E6%95%88%E7%BC%96%E7%A8%8B/%E9%87%8D%E6%9E%84/refused-bequest/Extract%20Superclass%20-%20After.png)

### 提炼子类(Extract Subclass)

**问题**

一个类中有些特性仅用于特定场景。

![img](https://raw.githubusercontent.com/atlantis1024/JavaParty/master/images/%E7%BC%96%E7%A8%8B/%E9%AB%98%E6%95%88%E7%BC%96%E7%A8%8B/%E9%87%8D%E6%9E%84/large-class/Extract Subclass - Before.png)

**解决**

创建一个子类，并将用于特殊场景的特性置入其中。

![img](https://raw.githubusercontent.com/atlantis1024/JavaParty/master/images/%E7%BC%96%E7%A8%8B/%E9%AB%98%E6%95%88%E7%BC%96%E7%A8%8B/%E9%87%8D%E6%9E%84/large-class/Extract Subclass - After.png)